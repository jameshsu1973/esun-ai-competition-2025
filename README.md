# ç‰å±±äººå·¥æ™ºæ…§å…¬é–‹æŒ‘æˆ°è³½ 2024 - è©æ¬ºäº¤æ˜“åµæ¸¬

## ğŸ“‹ å»ºæ¨¡æ¦‚è¿°

æœ¬å°ˆæ¡ˆé‡å°éŠ€è¡Œå¸³æˆ¶äº¤æ˜“è³‡æ–™é€²è¡Œè©æ¬ºåµæ¸¬åˆ†æï¼Œæ¡ç”¨ **Ensemble Learning** æ–¹æ³•çµåˆå¤šç¨®æ¢¯åº¦æå‡æ¨¹æ¨¡å‹ï¼ˆLightGBMã€XGBoostã€CatBoostï¼‰ï¼Œé€éé«˜æ´»èºå¸³æˆ¶æ¡æ¨£ç­–ç•¥å’Œè±å¯Œçš„ç‰¹å¾µå·¥ç¨‹ï¼Œæœ‰æ•ˆè­˜åˆ¥ç•°å¸¸äº¤æ˜“æ¨¡å¼ã€‚

### æ ¸å¿ƒæ–¹æ³•

1. **è³‡æ–™å‰è™•ç†**
   - å¤šå¹£åˆ¥çµ±ä¸€è½‰æ›ç‚º TWDï¼ˆå°å¹£ï¼‰
   - æ™‚é–“ç‰¹å¾µæå–ï¼ˆäº¤æ˜“æ™‚æ®µã€é¦–å°¾é€±åˆ†æï¼‰
   - äº¤æ˜“æµå‘åˆ†æï¼ˆè½‰å…¥/è½‰å‡ºçµ±è¨ˆï¼‰

2. **ç‰¹å¾µå·¥ç¨‹**ï¼ˆ62 ç¶­ç‰¹å¾µï¼‰
   - **åŸºæœ¬äº¤æ˜“çµ±è¨ˆ**ï¼šäº¤æ˜“æ¬¡æ•¸ã€è½‰å…¥è½‰å‡ºæ¯”ä¾‹
   - **é‡‘é¡ç‰¹å¾µ**ï¼šç¸½é¡ã€å¹³å‡å€¼ã€æ¨™æº–å·®ã€åˆ†ä½æ•¸ã€è®Šç•°ä¿‚æ•¸
   - **æ™‚é–“ç‰¹å¾µ**ï¼šæ´»èºå¤©æ•¸ã€å¤œé–“äº¤æ˜“æ¯”ä¾‹ã€çˆ†ç™¼åˆ†æ•¸
   - **å°æ‰‹æ–¹ç‰¹å¾µ**ï¼šäº¤æ˜“å°è±¡å¤šæ¨£æ€§ã€é›†ä¸­åº¦æŒ‡æ¨™
   - **äº¤æ˜“é¡å‹ç‰¹å¾µ**ï¼šè·¨è¡Œäº¤æ˜“ã€å¤–å¹£äº¤æ˜“ã€è‡ªè½‰äº¤æ˜“
   - **é¢¨éšªæŒ‡æ¨™**ï¼šå¤§é¡äº¤æ˜“æ¯”ä¾‹ã€äº¤æ˜“é›†ä¸­åº¦ã€æ™‚é–“ç†µ

3. **æ¡æ¨£ç­–ç•¥**
   - **High Activity 10x Sampling**ï¼šå¾ Top 30% é«˜æ´»èºå¸³æˆ¶ä¸­æ¡æ¨£
   - æ­£è² æ¨£æœ¬æ¯”ä¾‹ 1:10ï¼ˆ1,004 è­¦ç¤ºå¸³æˆ¶ + 10,040 é«˜æ´»èºéè­¦ç¤ºå¸³æˆ¶ï¼‰
   - é¿å…ä½æ´»èºå¸³æˆ¶æ±™æŸ“è¨“ç·´é›†

4. **æ¨¡å‹æ¶æ§‹**
   - **Ensemble æ¨¡å‹**ï¼šLightGBM + XGBoost + CatBoost
   - **è»ŸæŠ•ç¥¨ï¼ˆSoft Votingï¼‰**ï¼šå¹³å‡ä¸‰å€‹æ¨¡å‹çš„é æ¸¬æ©Ÿç‡
   - **5-Fold Stratified CV**ï¼šç¢ºä¿æ¯å€‹ fold ä¸­è­¦ç¤ºæ¨£æœ¬æ¯”ä¾‹ä¸€è‡´
   - **è‡ªå‹•é–¾å€¼æœç´¢**ï¼šåœ¨ 0.1-0.9 ç¯„åœå…§å°‹æ‰¾æœ€ä½³ F1 åˆ†æ•¸é–¾å€¼

5. **æ¨¡å‹å„ªåŒ–**
   - Scale Pos Weightï¼šè™•ç†é¡åˆ¥ä¸å¹³è¡¡
   - æ¨™æº–åŒ–ï¼ˆStandardScalerï¼‰ï¼šç‰¹å¾µç¸®æ”¾
   - ç‰¹å¾µé‡è¦æ€§åˆ†æï¼šè­˜åˆ¥é—œéµè©æ¬ºæŒ‡æ¨™

---

## ğŸ–¥ï¸ ç’°å¢ƒéœ€æ±‚

### Python ç‰ˆæœ¬
```
Python 3.11.7
```

### å¥—ä»¶ä¾è³´
è©³è¦‹ `requirements.txt`ï¼Œä¸»è¦å¥—ä»¶ç‰ˆæœ¬ï¼š

| å¥—ä»¶ | ç‰ˆæœ¬ |
|------|------|
| pandas | 2.2.3 |
| numpy | 1.26.0 |
| scikit-learn | 1.6.0 |
| lightgbm | 4.6.0 |
| xgboost | 3.0.1 |
| catboost | 1.2.8 |
| matplotlib | 3.8.0 |
| joblib | 1.2.0 |

### å®‰è£æ–¹å¼
```bash
pip install -r requirements.txt
```

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
AI_cup/
â”‚
â”œâ”€â”€ README.md                          # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ QUICKSTART.md                      # åŸ·è¡Œèªªæ˜æ–‡ä»¶
â”œâ”€â”€ requirements.txt                   # Python å¥—ä»¶ä¾è³´æ¸…å–®ï¼ˆå«ç‰ˆæœ¬è™Ÿï¼‰
â”œâ”€â”€ .gitignore                         # Git å¿½ç•¥æª”æ¡ˆæ¸…å–®
â”œâ”€â”€ git_setup.ps1                      # Git åˆå§‹åŒ–è…³æœ¬
â”‚
â”œâ”€â”€ main.py                            # æ¨¡çµ„åŒ–åŸ·è¡Œå…¥å£ï¼ˆæ¨è–¦ç”¨æ–¼å­¸ç¿’æ¶æ§‹ï¼‰
â”œâ”€â”€ ImprovedFraudDetector.py          # æ•´åˆå¼ä¸»ç¨‹å¼ï¼ˆæ¨è–¦ç”¨æ–¼å¿«é€ŸåŸ·è¡Œï¼‰
â”‚
â”œâ”€â”€ Config/                            # ã€é…ç½®æ¨¡çµ„ã€‘é›†ä¸­ç®¡ç†æ‰€æœ‰è¶…åƒæ•¸èˆ‡è¨­å®š
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡çµ„åˆå§‹åŒ–æª”æ¡ˆ
â”‚   â””â”€â”€ config.py                      # è¶…åƒæ•¸ã€è·¯å¾‘ã€åŒ¯ç‡ç­‰é…ç½®é¡åˆ¥
â”‚
â”œâ”€â”€ Preprocess/                        # ã€è³‡æ–™å‰è™•ç†æ¨¡çµ„ã€‘è³‡æ–™è¼‰å…¥èˆ‡ç‰¹å¾µå·¥ç¨‹
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡çµ„åˆå§‹åŒ–æª”æ¡ˆ
â”‚   â”œâ”€â”€ data_loader.py                 # DataLoader é¡åˆ¥ï¼šè¼‰å…¥ä¸¦é è™•ç†åŸå§‹è³‡æ–™
â”‚   â””â”€â”€ feature_engineering.py        # FeatureEngineer é¡åˆ¥ï¼šæå– 62 ç¶­ç‰¹å¾µ
â”‚
â”œâ”€â”€ Model/                             # ã€æ¨¡å‹æ¨¡çµ„ã€‘è¨“ç·´èˆ‡é æ¸¬
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡çµ„åˆå§‹åŒ–æª”æ¡ˆ
â”‚   â”œâ”€â”€ ensemble_trainer.py            # EnsembleTrainer é¡åˆ¥ï¼šEnsemble è¨“ç·´èˆ‡ CV
â”‚   â””â”€â”€ predictor.py                   # Predictor é¡åˆ¥ï¼šæ¨¡å‹é æ¸¬èˆ‡çµæœè¼¸å‡º
â”‚
â”œâ”€â”€ Utils/                             # ã€å·¥å…·æ¨¡çµ„ã€‘è©•ä¼°èˆ‡è¦–è¦ºåŒ–
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡çµ„åˆå§‹åŒ–æª”æ¡ˆ
â”‚   â”œâ”€â”€ evaluation.py                  # find_best_threshold å‡½æ•¸ï¼šæœ€ä½³é–¾å€¼æœç´¢
â”‚   â””â”€â”€ visualization.py               # plot_threshold_analysis å‡½æ•¸ï¼šé–¾å€¼åˆ†æåœ–
â”‚
â”œâ”€â”€ 40_åˆè³½è³‡æ–™_V3 1/                  # ã€ç«¶è³½è³‡æ–™ã€‘ï¼ˆè«‹è‡ªè¡Œä¸‹è¼‰ï¼‰
â”‚   â””â”€â”€ åˆè³½è³‡æ–™/
â”‚       â”œâ”€â”€ acct_transaction.csv       # äº¤æ˜“æ˜ç´°è³‡æ–™ï¼ˆå«æ™‚é–“ã€é‡‘é¡ã€å°æ‰‹æ–¹ç­‰ï¼‰
â”‚       â”œâ”€â”€ acct_alert.csv             # è­¦ç¤ºå¸³æˆ¶æ¨™ç±¤ï¼ˆè¨“ç·´é›†ç›®æ¨™è®Šæ•¸ï¼‰
â”‚       â””â”€â”€ acct_predict.csv           # å¾…é æ¸¬å¸³æˆ¶æ¸…å–®ï¼ˆæ¸¬è©¦é›†å¸³æˆ¶ IDï¼‰
â”‚
â””â”€â”€ output/                            # ã€è¼¸å‡ºç›®éŒ„ã€‘æ¨¡å‹çµæœèˆ‡å¿«å–æª”æ¡ˆ
    â”œâ”€â”€ submission_improved.csv        # æœ€çµ‚é æ¸¬çµæœï¼ˆç«¶è³½æäº¤æ ¼å¼ï¼šacct, labelï¼‰
    â”œâ”€â”€ submission_improved_with_prob.csv  # å«æ©Ÿç‡ç‰ˆæœ¬ï¼ˆä¾›åˆ†æä½¿ç”¨ï¼‰
    â”œâ”€â”€ features_train.pkl             # è¨“ç·´é›†ç‰¹å¾µå¿«å–ï¼ˆ62 ç¶­ Ã— N æ¨£æœ¬ï¼‰
    â”œâ”€â”€ features_test.pkl              # æ¸¬è©¦é›†ç‰¹å¾µå¿«å–ï¼ˆ62 ç¶­ Ã— 4,780 æ¨£æœ¬ï¼‰
    â””â”€â”€ threshold_analysis.png         # é–¾å€¼åˆ†æè¦–è¦ºåŒ–åœ–è¡¨
```

---

## ğŸ“‚ å„æª”æ¡ˆèˆ‡è³‡æ–™å¤¾è©³ç´°èªªæ˜

### ğŸ”§ é…ç½®æª”æ¡ˆ

#### `Config/config.py`
**ç”¨é€”**: é›†ä¸­ç®¡ç†æ‰€æœ‰è¶…åƒæ•¸èˆ‡è·¯å¾‘è¨­å®šï¼Œæ–¹ä¾¿èª¿æ•´å¯¦é©—é…ç½®
- **Config é¡åˆ¥**: åŒ…å«æ‰€æœ‰é…ç½®å¸¸æ•¸
  - **è·¯å¾‘è¨­å®š**: è³‡æ–™è·¯å¾‘ã€è¼¸å‡ºè·¯å¾‘ã€å¿«å–æª”æ¡ˆåç¨±
  - **éš¨æ©Ÿç¨®å­**: ç¢ºä¿å¯¦é©—å¯é‡ç¾æ€§ï¼ˆRANDOM_SEED = 42ï¼‰
  - **æ¡æ¨£ç­–ç•¥**: High Activity 10xï¼ˆTOP_PERCENTILE=0.3, NEGATIVE_MULTIPLIER=10ï¼‰
  - **å¹£åˆ¥åŒ¯ç‡**: 15 ç¨®è²¨å¹£å° TWD çš„åŒ¯ç‡å­—å…¸
  - **æ¨¡å‹è¶…åƒæ•¸**: LightGBMã€XGBoostã€CatBoost çš„åƒæ•¸è¨­å®š
  - **äº¤å‰é©—è­‰**: 5-Fold Stratified CV é…ç½®
  - **é–¾å€¼æœç´¢**: ç¯„åœ 0.1-0.9ï¼Œæ­¥é•· 0.01

---

### ğŸ“Š è³‡æ–™å‰è™•ç†æ¨¡çµ„ (Preprocess/)

#### `Preprocess/data_loader.py`
**ç”¨é€”**: è¼‰å…¥ç«¶è³½åŸå§‹è³‡æ–™ä¸¦é€²è¡ŒåŸºæœ¬é è™•ç†
- **DataLoader é¡åˆ¥**: è³‡æ–™è¼‰å…¥å™¨
  - `__init__(data_path)`: åˆå§‹åŒ–è³‡æ–™è·¯å¾‘
  - `load_all()`: è¼‰å…¥ä¸‰å€‹ CSV æª”æ¡ˆï¼ˆäº¤æ˜“ã€è­¦ç¤ºã€å¾…æ¸¬ï¼‰
    - è§£æäº¤æ˜“æ™‚é–“ç‚ºå°æ™‚ç‰¹å¾µ
    - çµ±ä¸€å¹£åˆ¥è½‰æ›ç‚º TWDï¼ˆä½¿ç”¨ Config.EXCHANGE_RATESï¼‰
    - å›å‚³é è™•ç†å¾Œçš„ DataFrame

#### `Preprocess/feature_engineering.py`
**ç”¨é€”**: å¾äº¤æ˜“è³‡æ–™ä¸­æå– 62 ç¶­ç‰¹å¾µå‘é‡
- **FeatureEngineer é¡åˆ¥**: ç‰¹å¾µå·¥ç¨‹å™¨
  - `__init__(df_txn)`: åˆå§‹åŒ–äº¤æ˜“è³‡æ–™
  - `extract_train_features(df_alert, use_cache)`: æå–è¨“ç·´é›†ç‰¹å¾µ
    - å¯¦ä½œ High Activity 10x æ¡æ¨£ç­–ç•¥
    - å¾ Top 30% é«˜æ´»èºå¸³æˆ¶ä¸­æ¡æ¨£è² æ¨£æœ¬
    - æ”¯æ´å¿«å–æ©Ÿåˆ¶ï¼ˆfeatures_train.pklï¼‰
  - `extract_test_features(df_predict, use_cache)`: æå–æ¸¬è©¦é›†ç‰¹å¾µ
    - ç‚ºæ‰€æœ‰å¾…æ¸¬å¸³æˆ¶æå–ç‰¹å¾µ
    - æ”¯æ´å¿«å–æ©Ÿåˆ¶ï¼ˆfeatures_test.pklï¼‰
  - `_extract_features_batch(accts, stage_name)`: æ‰¹æ¬¡æå–ç‰¹å¾µ
    - ä½¿ç”¨ Joblib å¹³è¡Œè™•ç†åŠ é€Ÿ
    - é¡¯ç¤ºé€²åº¦æ¢
  - `_extract_account_features(acct)`: å–®ä¸€å¸³æˆ¶ç‰¹å¾µæå–
    - **åŸºæœ¬çµ±è¨ˆ** (5 å€‹): äº¤æ˜“æ¬¡æ•¸ã€è½‰å…¥è½‰å‡ºæ¯”ä¾‹ç­‰
    - **é‡‘é¡ç‰¹å¾µ** (23 å€‹): ç¸½é¡ã€å‡å€¼ã€æ¨™æº–å·®ã€åˆ†ä½æ•¸ã€CV ç­‰
    - **æ™‚é–“ç‰¹å¾µ** (13 å€‹): æ—¥æœŸç¯„åœã€æ´»èºå¤©æ•¸ã€å¤œé–“æ¯”ä¾‹ã€çˆ†ç™¼åˆ†æ•¸ç­‰
    - **å°æ‰‹æ–¹ç‰¹å¾µ** (4 å€‹): äº¤æ˜“å°è±¡å¤šæ¨£æ€§ã€é›†ä¸­åº¦ç­‰
    - **äº¤æ˜“é¡å‹** (11 å€‹): è·¨è¡Œäº¤æ˜“ã€å¤–å¹£äº¤æ˜“ã€è‡ªè½‰äº¤æ˜“ç­‰
    - **é¢¨éšªæŒ‡æ¨™** (14 å€‹): å¤§é¡äº¤æ˜“æ¯”ä¾‹ã€æ™‚é–“ç†µã€è³‡é‡‘å¹³è¡¡åº¦ç­‰
  - `_get_empty_features()`: ç„¡äº¤æ˜“å¸³æˆ¶çš„é›¶å¡«å……ç‰¹å¾µ

---

### ğŸ¤– æ¨¡å‹æ¨¡çµ„ (Model/)

#### `Model/ensemble_trainer.py`
**ç”¨é€”**: è¨“ç·´ Ensemble æ¨¡å‹ä¸¦é€²è¡Œäº¤å‰é©—è­‰
- **EnsembleTrainer é¡åˆ¥**: Ensemble è¨“ç·´å™¨
  - `__init__(config)`: åˆå§‹åŒ–é…ç½®èˆ‡æ¨¡å‹å®¹å™¨
  - `train(df_train)`: ä¸»è¦è¨“ç·´æµç¨‹
    - ç‰¹å¾µæ¨™æº–åŒ–ï¼ˆStandardScalerï¼‰
    - 5-Fold Stratified CV ç¢ºä¿æ¯å€‹ fold è­¦ç¤ºæ¯”ä¾‹ä¸€è‡´
    - æ¯å€‹ fold è¨“ç·´ä¸‰å€‹æ¨¡å‹ï¼ˆLightGBMã€XGBoostã€CatBoostï¼‰
    - æ”¶é›†é©—è­‰é›†é æ¸¬æ©Ÿç‡ç”¨æ–¼é–¾å€¼æœç´¢
    - å‘¼å« `find_best_threshold()` æ‰¾å‡ºæœ€ä½³é–¾å€¼
    - å‘¼å« `plot_threshold_analysis()` ç¹ªè£½åˆ†æåœ–
  - `_train_lightgbm(X, y, pos_weight)`: è¨“ç·´ LightGBM
  - `_train_xgboost(X, y, pos_weight)`: è¨“ç·´ XGBoost
  - `_train_catboost(X, y, pos_weight)`: è¨“ç·´ CatBoost
  - `_print_feature_importance(feature_cols)`: è¼¸å‡º Top 15 é‡è¦ç‰¹å¾µ

#### `Model/predictor.py`
**ç”¨é€”**: è¼‰å…¥è¨“ç·´å¥½çš„æ¨¡å‹é€²è¡Œé æ¸¬ä¸¦å„²å­˜çµæœ
- **Predictor é¡åˆ¥**: æ¨¡å‹é æ¸¬å™¨
  - `__init__(models, scaler, threshold, feature_cols)`: åˆå§‹åŒ–é æ¸¬å™¨
  - `predict(df_test)`: Ensemble é æ¸¬
    - å°ä¸‰ç¨®æ¨¡å‹ï¼ˆæ¯ç¨® 5 å€‹ foldï¼‰é€²è¡Œè»ŸæŠ•ç¥¨
    - è¨ˆç®—å¹³å‡é æ¸¬æ©Ÿç‡
    - ä½¿ç”¨æœ€ä½³é–¾å€¼è½‰æ›ç‚º 0/1 æ¨™ç±¤
    - è¼¸å‡ºé æ¸¬çµ±è¨ˆè³‡è¨Šï¼ˆæ¯”ä¾‹ã€æ©Ÿç‡åˆ†å¸ƒï¼‰
  - `save(predictions, probabilities, account_ids, output_path)`: å„²å­˜çµæœ
    - å„²å­˜ç«¶è³½æäº¤æ ¼å¼ï¼ˆsubmission_improved.csvï¼‰
    - é¡å¤–å„²å­˜å«æ©Ÿç‡ç‰ˆæœ¬ä¾›åˆ†æ

---

### ğŸ› ï¸ å·¥å…·æ¨¡çµ„ (Utils/)

#### `Utils/evaluation.py`
**ç”¨é€”**: è©•ä¼°æŒ‡æ¨™è¨ˆç®—èˆ‡æœ€ä½³é–¾å€¼æœç´¢
- **find_best_threshold(y_true, y_probs, threshold_min, threshold_max, threshold_step)**: 
  - åœ¨æŒ‡å®šç¯„åœå…§æœç´¢ä½¿ F1 æœ€å¤§åŒ–çš„é–¾å€¼
  - åŒæ™‚è¨ˆç®— Precision å’Œ Recall
  - å›å‚³æœ€ä½³é–¾å€¼ã€æœ€ä½³ F1 å’Œæ‰€æœ‰é–¾å€¼çš„çµæœå­—å…¸

#### `Utils/visualization.py`
**ç”¨é€”**: è¦–è¦ºåŒ–åˆ†æå·¥å…·
- **plot_threshold_analysis(threshold_results, best_threshold, save_path)**:
  - ç¹ªè£½ F1ã€Precisionã€Recall vs Threshold æ›²ç·š
  - æ¨™è¨˜æœ€ä½³é–¾å€¼ä½ç½®
  - å„²å­˜é«˜è§£æåº¦åœ–è¡¨ï¼ˆthreshold_analysis.pngï¼‰

---

### ğŸš€ ä¸»ç¨‹å¼

#### `main.py`
**ç”¨é€”**: æ¨¡çµ„åŒ–åŸ·è¡Œç¯„ä¾‹ï¼Œå±•ç¤ºå¦‚ä½•çµ„åˆå„æ¨¡çµ„
- åˆ†æ­¥é©Ÿå‘¼å«å„æ¨¡çµ„çš„é¡åˆ¥èˆ‡å‡½æ•¸
- é©åˆå­¸ç¿’å°ˆæ¡ˆæ¶æ§‹èˆ‡æ¨¡çµ„é–“äº’å‹•
- å¯è‡ªè¨‚å„éšæ®µåƒæ•¸

#### `ImprovedFraudDetector.py`
**ç”¨é€”**: æ•´åˆå¼ä¸»ç¨‹å¼ï¼ŒåŒ…å«å®Œæ•´è¨“ç·´èˆ‡é æ¸¬æµç¨‹
- ä¸€éµåŸ·è¡Œå®Œæ•´ Pipeline
- å…§å»ºæ‰€æœ‰é‚è¼¯ï¼ˆä¸ä¾è³´å¤–éƒ¨æ¨¡çµ„ï¼‰
- é©åˆå¿«é€ŸåŸ·è¡Œèˆ‡çµæœé‡ç¾
- **æ¨è–¦ç”¨æ–¼å¯¦éš›ç«¶è³½æäº¤**

---

### ğŸ“„ æ–‡ä»¶æª”æ¡ˆ

#### `README.md`
æœ¬æª”æ¡ˆï¼ŒåŒ…å«å®Œæ•´å°ˆæ¡ˆèªªæ˜ã€ç’°å¢ƒéœ€æ±‚ã€ä½¿ç”¨æ–¹æ³•ã€å¯¦é©—çµæœ

#### `QUICKSTART.md`
å¿«é€Ÿé–‹å§‹æŒ‡å—ï¼Œæä¾› 3 åˆ†é˜å¿«é€ŸåŸ·è¡Œæ­¥é©Ÿ

#### `PROJECT_SUMMARY.md`
å°ˆæ¡ˆç¸½çµèˆ‡ GitHub ä¸Šå‚³æª¢æŸ¥æ¸…å–®

#### `requirements.txt`
Python å¥—ä»¶ä¾è³´æ¸…å–®ï¼Œå«ç²¾ç¢ºç‰ˆæœ¬è™Ÿï¼ˆå¦‚ pandas==2.2.3ï¼‰

---

### ğŸ“¦ è¼¸å‡ºæª”æ¡ˆ (output/)

#### `submission_improved.csv`
æœ€çµ‚é æ¸¬çµæœï¼Œç«¶è³½æäº¤æ ¼å¼ï¼š
```
acct,label
123456,0
789012,1
...
```

#### `submission_improved_with_prob.csv`
å«é æ¸¬æ©Ÿç‡ç‰ˆæœ¬ï¼Œä¾›å¾ŒçºŒåˆ†æï¼š
```
acct,label,probability
123456,0,0.234
789012,1,0.876
...
```

#### `features_train.pkl` & `features_test.pkl`
ç‰¹å¾µå¿«å–æª”æ¡ˆï¼ˆPickle æ ¼å¼ï¼‰ï¼ŒåŠ é€Ÿé‡è¤‡åŸ·è¡Œ

#### `threshold_analysis.png`
é–¾å€¼åˆ†æè¦–è¦ºåŒ–åœ–è¡¨ï¼Œå±•ç¤ºä¸åŒé–¾å€¼ä¸‹çš„ F1/Precision/Recall

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è³‡æ–™æº–å‚™
å°‡ç«¶è³½è³‡æ–™æ”¾ç½®æ–¼ `./40_åˆè³½è³‡æ–™_V3 1/åˆè³½è³‡æ–™/` ç›®éŒ„ä¸‹ï¼š
```
40_åˆè³½è³‡æ–™_V3 1/
â””â”€â”€ åˆè³½è³‡æ–™/
    â”œâ”€â”€ acct_transaction.csv
    â”œâ”€â”€ acct_alert.csv
    â””â”€â”€ acct_predict.csv
```

### 2. å¿«é€ŸåŸ·è¡Œï¼ˆæ¨è–¦ï¼‰
ç›´æ¥åŸ·è¡Œæ•´åˆä¸»ç¨‹å¼ï¼š
```bash
python ImprovedFraudDetector.py
```

åŸ·è¡Œæµç¨‹ï¼š
1. è¼‰å…¥è³‡æ–™ä¸¦é€²è¡Œå¹£åˆ¥è½‰æ›
2. æå–è¨“ç·´é›†ç‰¹å¾µï¼ˆä½¿ç”¨å¿«å–åŠ é€Ÿï¼‰
3. æå–æ¸¬è©¦é›†ç‰¹å¾µï¼ˆä½¿ç”¨å¿«å–åŠ é€Ÿï¼‰
4. è¨“ç·´ Ensemble æ¨¡å‹ï¼ˆ5-Fold CVï¼‰
5. è‡ªå‹•æœç´¢æœ€ä½³é–¾å€¼
6. é æ¸¬ä¸¦å„²å­˜çµæœè‡³ `output/submission_improved.csv`

### 3. æ¨¡çµ„åŒ–åŸ·è¡Œï¼ˆé€²éšï¼‰
åˆ†æ­¥é©ŸåŸ·è¡Œå„æ¨¡çµ„ï¼š

```python
from Config.config import Config
from Preprocess.data_loader import DataLoader
from Preprocess.feature_engineering import FeatureEngineer
from Model.ensemble_trainer import EnsembleTrainer
from Model.predictor import Predictor

# 1. è¼‰å…¥è³‡æ–™
loader = DataLoader(Config.DATA_PATH)
df_txn, df_alert, df_predict = loader.load_all()

# 2. ç‰¹å¾µå·¥ç¨‹
engineer = FeatureEngineer(df_txn)
df_train = engineer.extract_train_features(df_alert, use_cache=True)
df_test = engineer.extract_test_features(df_predict, use_cache=True)

# 3. è¨“ç·´æ¨¡å‹
trainer = EnsembleTrainer(Config)
trainer.train(df_train)

# 4. é æ¸¬
predictor = Predictor(trainer.models, trainer.scaler, trainer.threshold)
predictions = predictor.predict(df_test)
predictor.save(predictions, df_predict['acct'])
```

### 4. ç‰¹å¾µå¿«å–èªªæ˜
é¦–æ¬¡åŸ·è¡Œæœƒæå–æ‰€æœ‰ç‰¹å¾µä¸¦å¿«å–è‡³ï¼š
- `features_train.pkl`ï¼ˆè¨“ç·´é›†ç‰¹å¾µï¼‰
- `features_test.pkl`ï¼ˆæ¸¬è©¦é›†ç‰¹å¾µï¼‰

å¾ŒçºŒåŸ·è¡Œå°‡è‡ªå‹•è¼‰å…¥å¿«å–ï¼Œå¤§å¹…åŠ é€Ÿé‹è¡Œæ™‚é–“ã€‚å¦‚éœ€é‡æ–°æå–ç‰¹å¾µï¼š
```python
detector.prepare_training_data(use_cache=False)
detector.prepare_test_data(use_cache=False)
```

---

## âš™ï¸ è¶…åƒæ•¸è¨­å®š

### æ¡æ¨£ç­–ç•¥
```python
SAMPLING_STRATEGY = 'high_activity_10x'
TOP_PERCENTILE = 0.3      # å¾ Top 30% é«˜æ´»èºå¸³æˆ¶ä¸­æ¡æ¨£
NEGATIVE_MULTIPLIER = 10  # è² æ¨£æœ¬ç‚ºæ­£æ¨£æœ¬çš„ 10 å€
```

### LightGBM
```python
num_leaves = 31
learning_rate = 0.05
n_estimators = 500
scale_pos_weight = 10.0  # æ ¹æ“šæ­£è² æ¨£æœ¬æ¯”ä¾‹è‡ªå‹•è¨ˆç®—
random_state = 42
```

### XGBoost
```python
max_depth = 6
learning_rate = 0.05
n_estimators = 500
scale_pos_weight = 10.0
random_state = 42
```

### CatBoost
```python
iterations = 500
learning_rate = 0.05
depth = 6
scale_pos_weight = 10.0
random_seed = 42
```

### äº¤å‰é©—è­‰èˆ‡é–¾å€¼
```python
N_SPLITS = 5              # 5-Fold Stratified CV
THRESHOLD_RANGE = (0.1, 0.9)  # é–¾å€¼æœç´¢ç¯„åœ
THRESHOLD_STEP = 0.01     # é–¾å€¼æœç´¢æ­¥é•·
```

### è³‡æºé…ç½®
```python
RANDOM_SEED = 42          # ç¢ºä¿çµæœå¯å¾©ç¾
N_JOBS = -1               # ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒï¼ˆLightGBM/XGBoostï¼‰
```

---

## ğŸ“ˆ é–¾å€¼åˆ†æè¦–è¦ºåŒ–

åŸ·è¡Œå¾Œæœƒç”Ÿæˆ `threshold_analysis.png`ï¼Œå±•ç¤ºï¼š
- F1 Score vs Threshold æ›²ç·š
- Precision vs Threshold æ›²ç·š
- Recall vs Threshold æ›²ç·š
- æœ€ä½³é–¾å€¼æ¨™è¨˜

![é–¾å€¼åˆ†æç¤ºæ„åœ–](threshold_analysis.png)

---

## ğŸ” é—œéµç™¼ç¾

### 1. æ™‚é–“ç‰¹å¾µæœ€é‡è¦
- `date_range`ã€`first_week_ratio`ã€`last_week_ratio` ç‚ºæœ€é‡è¦ç‰¹å¾µ
- è©æ¬ºå¸³æˆ¶å¾€å¾€åœ¨çŸ­æœŸå…§é›†ä¸­äº¤æ˜“

### 2. é‡‘é¡å¹³è¡¡èˆ‡é›†ä¸­åº¦
- `amt_balance`ã€`in_concentration` æœ‰æ•ˆå€åˆ†è©æ¬ºæ¨¡å¼
- è©æ¬ºå¸³æˆ¶å¸¸æœ‰ç•°å¸¸çš„è³‡é‡‘æµå‘

### 3. å¤œé–“èˆ‡è·¨è¡Œäº¤æ˜“
- `night_txn_ratio`ã€`cross_bank_ratio` ç‚ºé‡è¦é¢¨éšªæŒ‡æ¨™
- ç•°å¸¸æ™‚æ®µèˆ‡è·¨è¡Œè½‰å¸³å€¼å¾—é—œæ³¨

### 4. é«˜æ´»èºæ¡æ¨£ç­–ç•¥æœ‰æ•ˆ
- Top 30% é«˜æ´»èºå¸³æˆ¶ä½œç‚ºè² æ¨£æœ¬è¡¨ç¾æœ€ä½³
- é¿å…ä½æ´»èºå¸³æˆ¶ç¨€é‡‹æ¨¡å‹åˆ¤æ–·åŠ›

---

## ğŸ‘¥ åƒè³½éšŠä¼è³‡è¨Š

- **éšŠä¼åç¨±**: [TEAM_8423]
- **éšŠé•·**: è¨±æ™ºæ©
- **éšŠå“¡**: é™³æ˜Ÿå®‡
- **éšŠå“¡**: æç«‹å®‰
- **éšŠå“¡**: æé›²çŠ

---

## ğŸ“§ è¯çµ¡æ–¹å¼

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œæ­¡è¿è¯ç¹«ï¼š
- **Email**: jameshsu1973@gmail.com

---

## ğŸ“„ æˆæ¬Š

æœ¬å°ˆæ¡ˆåƒ…ä¾›å­¸è¡“ç ”ç©¶èˆ‡ç«¶è³½ä½¿ç”¨ã€‚

---
